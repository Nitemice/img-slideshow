<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Offline Random Image Slideshow (folders + files)</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;color-scheme:light}
    body{margin:0;padding:18px;background:#f6f7fb;color:#0b1220}
    h1{margin:0 0 12px;font-size:20px}
    .topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .btn{background:#0b63ff;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.secondary{background:#eef2ff;color:#0b1220}
    .btn.ghost{background:transparent;border:1px solid #cbd5ff;color:#0b1220}
    .controls{display:flex;gap:8px;align-items:center}
    input[type=file]{display:none}
    #gallery{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .thumb{width:160px;height:120px;overflow:hidden;border-radius:8px;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(3,10,30,0.06);cursor:pointer}
    .thumb img{max-width:100%;max-height:100%;object-fit:cover}

    /* Fullscreen slideshow overlay */
    #overlay{position:fixed;inset:0;display:none;background:rgba(6,10,20,0.9);align-items:center;justify-content:center;z-index:999;padding:20px}
    #overlay.open{display:flex}
    #slideBox{max-width:95%;max-height:85%;display:flex;flex-direction:column;align-items:center}
    #slideImg{max-width:100%;max-height:100%;border-radius:8px;box-shadow:0 8px 40px rgba(0,0,0,0.6)}
    #overlayCaption{color:#fff;margin-top:10px}
    /* controls inside overlay */
    #overlayControls{margin-top:14px;display:flex;gap:8px;align-items:center}
    #overlayControls button,input{padding:8px 10px;border-radius:6px;border:0}
    #overlayControls button{cursor:pointer}
    input[type=number]{width:80px}

    .meta{font-size:13px;color:#445;margin-top:6px}

    @media (max-width:600px){ .thumb{width:120px;height:90px} }
  </style>
</head>
<body>
  <h1>Offline Random Image Slideshow (folders + files)</h1>

  <div class="topbar">
    <div class="controls">
      <label class="btn ghost" id="chooseBtn">Choose files / folders</label>
      <input id="fileInput" type="file" multiple webkitdirectory />
      <button class="btn secondary" id="shuffleBtn">Shuffle</button>
      <button class="btn" id="randomBtn">Random</button>
      <button class="btn ghost" id="clearBtn">Clear</button>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <label for="startBtn" class="btn" id="startBtn">Start Slideshow</label>
    </div>
  </div>

  <div class="meta" id="info">No images loaded.</div>
  <div id="gallery" aria-live="polite"></div>

  <!-- Fullscreen overlay with controls (visible during slideshow) -->
  <div id="overlay" role="dialog" aria-modal="true">
    <div id="slideBox">
      <img id="slideImg" src="" alt="slide image" />
      <div id="overlayCaption"></div>
      <div id="overlayControls">
        <button id="prevBtn" class="btn secondary">⟨ Prev</button>
        <button id="playPauseBtn" class="btn">▶ Play</button>
        <button id="nextBtn" class="btn secondary">Next ⟩</button>
        <label style="color:#fff">Duration (s): <input id="durationInput" type="number" min="1" value="2" /></label>
        <button id="closeOverlay" class="btn ghost">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Single input handles both files and folders (webkitdirectory). Works with file:// if user chooses folders.
    const chooseBtn = document.getElementById('chooseBtn');
    const fileInput = document.getElementById('fileInput');
    const gallery = document.getElementById('gallery');
    const info = document.getElementById('info');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const randomBtn = document.getElementById('randomBtn');
    const clearBtn = document.getElementById('clearBtn');
    const startBtn = document.getElementById('startBtn');

    const overlay = document.getElementById('overlay');
    const slideImg = document.getElementById('slideImg');
    const overlayCaption = document.getElementById('overlayCaption');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const durationInput = document.getElementById('durationInput');
    const closeOverlay = document.getElementById('closeOverlay');

    let images = []; // {name,url}
    let currentIndex = 0;
    let intervalMs = parseInt(durationInput.value,10) * 1000;
    let slideshowTimer = null;

    // wire up choose label to hidden file input
    chooseBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => handleFiles(e.target.files));

    function handleFiles(fileList){
      const arr = Array.from(fileList).filter(f => f.type && f.type.startsWith('image/'));
      if (!arr.length) return;
      const added = arr.map(f => ({ name: f.webkitRelativePath || f.name, url: URL.createObjectURL(f) }));
      images.push(...added);
      updateInfo();
      renderGallery();
    }

    function updateInfo(){
      info.textContent = `${images.length} image${images.length !== 1 ? 's' : ''} loaded.`;
    }

    function renderGallery(){
      gallery.innerHTML = '';
      images.forEach((it, i) => {
        const d = document.createElement('div');
        d.className = 'thumb';
        const img = document.createElement('img');
        img.src = it.url;
        img.alt = it.name;
        d.appendChild(img);
        d.addEventListener('click', () => openOverlay(i));
        gallery.appendChild(d);
      });
    }

    function openOverlay(index){
      if (!images.length) return;
      currentIndex = ((index % images.length)+images.length)%images.length;
      const item = images[currentIndex];
      slideImg.src = item.url;
      overlayCaption.textContent = item.name;
      overlay.classList.add('open');
    }

    function close(){
      overlay.classList.remove('open');
      stopSlideshow();
    }

    // slideshow controls
    function showAt(i){
      if (!images.length) return;
      currentIndex = ((i % images.length)+images.length)%images.length;
      const it = images[currentIndex];
      slideImg.src = it.url;
      overlayCaption.textContent = it.name;
    }

    function next(){ showAt(currentIndex+1); }
    function prev(){ showAt(currentIndex-1); }

    function startSlideshow(){
      if (!images.length) return alert('Please select images or folders first');
      // ensure overlay open and controls visible
      overlay.classList.add('open');
      // update interval
      intervalMs = Math.max(1, parseFloat(durationInput.value) || 2) * 1000;
      // show current image immediately
      showAt(currentIndex);
      // start timer
      stopSlideshow();
      slideshowTimer = setInterval(() => { next(); }, intervalMs);
      playPauseBtn.textContent = '⏸ Pause';
    }

    function stopSlideshow(){
      if (slideshowTimer){ clearInterval(slideshowTimer); slideshowTimer = null; }
      playPauseBtn.textContent = '▶ Play';
    }

    function togglePlayPause(){
      if (slideshowTimer) stopSlideshow(); else startSlideshow();
    }

    // UI wiring
    shuffleBtn.addEventListener('click', () => {
      if (!images.length) return alert('No images to shuffle');
      images = shuffleArray(images);
      renderGallery();
    });
    randomBtn.addEventListener('click', () => {
      if (!images.length) return alert('No images loaded');
      const idx = Math.floor(Math.random()*images.length);
      openOverlay(idx);
    });
    clearBtn.addEventListener('click', () => {
      images.forEach(i => { try{ URL.revokeObjectURL(i.url); }catch(e){} });
      images = [];
      gallery.innerHTML = '';
      updateInfo();
      stopSlideshow();
      overlay.classList.remove('open');
    });

    startBtn.addEventListener('click', () => startSlideshow());
    playPauseBtn.addEventListener('click', togglePlayPause);
    nextBtn.addEventListener('click', () => { stopSlideshow(); next(); });
    prevBtn.addEventListener('click', () => { stopSlideshow(); prev(); });
    closeOverlay.addEventListener('click', close);

    durationInput.addEventListener('change', () => {
      intervalMs = Math.max(1, parseFloat(durationInput.value) || 2) * 1000;
      if (slideshowTimer){ // restart with new duration
        startSlideshow();
      }
    });

    // keyboard support
    document.addEventListener('keydown', (e) => {
      if (!overlay.classList.contains('open')) return;
      if (e.key === 'Escape') close();
      if (e.key === 'ArrowRight') { stopSlideshow(); next(); }
      if (e.key === 'ArrowLeft') { stopSlideshow(); prev(); }
      if (e.key === ' ') { e.preventDefault(); togglePlayPause(); }
    });

    // click outside image closes
    overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });

    // Fisher-Yates
    function shuffleArray(arr){
      const a = arr.slice();
      for (let i = a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a;
    }

    // keep UI state consistent
    updateInfo();
  </script>
</body>
</html>
